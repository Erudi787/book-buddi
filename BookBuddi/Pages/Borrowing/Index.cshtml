@page
@model BookBuddi.Pages.Borrowing.IndexModel
@{
    ViewData["Title"] = "Borrow Transactions";
    var userRole = HttpContext.Session.GetString("UserRole");
}

<h1>@(userRole == "Member" ? "My Borrowing" : "Borrowing Transactions")</h1>

<p><a href="/Borrowing/Borrow">Borrow New Book</a></p>

<h2>@(userRole == "Member" ? "My Borrowed Books" : "Active Transactions")</h2>
<table border="1">
    <thead>
        <tr>
            <th>ID</th>
            <th>Book</th>
            @if (userRole == "Admin")
            {
                <th>Member</th>
            }
            <th>Borrow Date</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var transaction in Model.Transactions)
        {
            <tr style="@(transaction.Status == BookBuddi.Models.Enums.TransactionStatus.Overdue ? "background-color: #ffcccc;" : "")">
                <td>@transaction.TransactionId</td>
                <td>@transaction.Book?.BookTitle</td>
                @if (userRole == "Admin")
                {
                    <td>@transaction.Member?.FirstName @transaction.Member?.LastName</td>
                }
                <td>@transaction.BorrowDate.ToString("yyyy-MM-dd")</td>
                <td>@transaction.DueDate.ToString("yyyy-MM-dd")</td>
                <td>@transaction.Status</td>
                <td>
                    @if (transaction.Status == BookBuddi.Models.Enums.TransactionStatus.Active ||
                         transaction.Status == BookBuddi.Models.Enums.TransactionStatus.Overdue)
                    {
                        <a href="/Borrowing/Return?id=@transaction.TransactionId">Return</a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<p><a href="/">Back to Home</a></p>
